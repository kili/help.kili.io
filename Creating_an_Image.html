<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Preparing an Image for use on the Kili Cloud - Kili</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="Kili" />
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Preparing an Image for use on the Kili Cloud"/>
            <meta property="og:url" content="./Creating_an_Image.html"/>
            <meta property="og:description" content="A &#34;how to&#34; on creating or preparing existing images for"/>
            <meta property="article:published_time" content="2014-08-24" />
                <meta property="article:section" content="misc" />
                <meta property="article:tag" content="images" />
                <meta property="article:tag" content="how to" />
                <meta property="article:author" content="James Nzomo" />

    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
    
    <!-- Custom Fonts -->
    <link href='//fonts.googleapis.com/css?family=Roboto:400,700,300,500' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Oxygen" rel="stylesheet" type="text/css">

        <link href="./css/kili.css" rel="stylesheet">

        <link href="./feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="Kili ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Kili            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./Creating_an_Image.html"
                       rel="bookmark"
                       title="Permalink to Preparing an Image for use on the Kili Cloud">
                        Preparing an Image for use on the Kili Cloud
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
            <a href="./author/james-nzomo.html"><i class="fa fa-user"></i> James Nzomo</a> | 
    <span class="published">
        <time datetime="2014-08-24T14:00:00"> August 24, 2014</time>
    </span>



 | 
	<a href="./tag/images.html">images</a>
        /
	<a href="./tag/how-to.html">how to</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h3>INTRO</h3>
<p>This help article will illustrate how to prepare an existing image for use on Kili.</p>
<h3>Prerequisites</h3>
<ol>
<li>A kili account</li>
<li>For amd64 images, a cpu with virtualization extensions 
Intel VT or AMD-V. VIA VT may also work.</li>
</ol>
<h3>Getting an image</h3>
<p>An image is a virtual disk file with an operating system pre-installed on it. 
You can either download one from the many image providers out there or 
create one using virtualization software such as virtualbox or lib-virt.</p>
<p>The Kili Cloud uses qemu-KVM as it's hypervisor. This means that you will 
get better compatibility by using qcow2 as your image format.
You may also choose to go with raw disk format if you prefer performance 
over other features such as copy on write.
Using qemu also makes it possible for you to run images created for non-x86 
architectures (PPC, ARM, SPARK, MIPS...etc) on Kili.</p>
<p>If your virtualization app does not support qcow2, you can convert its native
image type to qcow2 using the 
<a href="http://docs.openstack.org/image-guide/content/ch_converting.html">qemu-img convert command</a> before uploading.</p>
<h3>Cloud init</h3>
<p>Before you can import your image to the cloud, it would be a good idea to 
install cloud-init on it. 
From <a href="http://cloudinit.readthedocs.org/en/latest/">readthedocs</a>, "Cloud-init 
is the de-facto multi-distribution package that handles early initialization 
of a cloud instance." Early initialization involves preparing instances during
boot up for use on the cloud.<br />
From the <a href="http://docs.openstack.org/image-guide/
content/ch_openstack_images.html">Official OpenStack docs</a>, 
some of these preparations involve:-</p>
<ul>
<li>Adding your public key (ssh) to the default user's authorized_keys</li>
<li>Disk Partitioning and resizing</li>
<li>Handling user-submitted data such as host-names</li>
<li>Setting repositories</li>
</ul>
<p>You can configure some of the above by editing <code>/etc/cloud/cloud.cfg</code>. 
For an example, with repositories, feel free to use the following 
as your primary mirrors:-</p>
<ul>
<li>Ubuntu (http://mirror.internal.ke-nbo-1a.kili.io/ubuntu/), </li>
<li>Debian (http://mirror.internal.ke-nbo-1a.kili.io/debian/)</li>
<li>and CentOS (http://mirror.internal.ke-nbo-1a.kili.io/centos/)</li>
</ul>
<p>You can set them as shown in the cloud-init 
<a href="http://cloudinit.readthedocs.org/en/latest/topics/examples.html#add-apt-repositories">apt-repo example</a> 
and the <a href="http://cloudinit.readthedocs.org/en/latest/topics/examples.html#adding-a-yum-repository">yum-repo example</a> </p>
<h3>The Boot log</h3>
<p>It will also be a good idea for your instances to boot verbosely 
by writing the boot log to the console. If you are building a Linux 
image, edit your <code>/boot/grub/grub.cfg</code> to pass the <code>console=ttyS0</code> 
parameter to your kernel and set <code>GRUB_CMDLINE_LINUX_DEFAULT="console=ttyS0"</code> 
in your <code>/etc/default/grub</code>file.<br />
Update your grub configuration by running <code>update-grub</code> for debian-based distros or <code>grub2-mkconfig -o /boot/grub2/grub.cfg</code> for fedora-based distros.</p>
<h3>Uploading your image</h3>
<p>To upload your image via the dashboard, visit this url :- 
https://dash.kili.io/project/images/create/ (login if you are prompted to), 
set the appropriate options and submit.   </p>
<p>To upload your image from the command line, see 
<a href="setting_up_cli.html">setting up cli tools</a> for installing and 
configuring python-glanceclient for use with your account.  </p>
<p>Here is an example of how to add an image from the cli:-</p>
<div class="highlight"><pre><span class="n">glance</span> <span class="n">image</span><span class="o">-</span><span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="s">&quot;Image name&quot;</span> <span class="o">--</span><span class="n">disk</span><span class="o">-</span><span class="n">format</span> <span class="n">qcow2</span> <span class="o">--</span><span class="n">container</span><span class="o">-</span><span class="n">format</span> <span class="n">bare</span> <span class="o">--</span><span class="n">min</span><span class="o">-</span><span class="n">disk</span> <span class="mi">30</span> <span class="o">--</span><span class="n">min</span><span class="o">-</span><span class="n">ram</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">file</span> <span class="n">IMAGENAME</span><span class="p">.</span><span class="n">qcow2</span> <span class="o">--</span><span class="n">is</span><span class="o">-</span><span class="n">public</span> <span class="n">False</span>
</pre></div>


<p>The above command that adds a qcow2 image for an instance that requires 
a minimum of 2GB for ram and 30 GB for root as a private image 
(no sharing with other kili tenants).<br />
Specifying these requirements facilitates forcing the right flavors when 
spinning up an instance from the image.</p>
<h3>Further reading</h3>
<ul>
<li>http://cloudinit.readthedocs.org/en/latest/</li>
<li>http://docs.openstack.org/image-guide/content/ch_obtaining_images.html</li>
</ul>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
	 <div class="col-xs-10">  
		 &copy; 2014 Kili.io, Inc &#9729; 
		 <a href="http://kili.io/#pricing">Pricing</a> &#9729;
		 <a href="https://dash.kili.io">Dashboard</a> &#9729;
		 <a href="https://github.com/kili/help.kili.io">Write an Article</a> 
	 </div>
	 </div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

</body>
</html>